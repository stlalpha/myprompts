#!/usr/bin/env zsh

# Vaporwave Dark Mode Zsh Prompt
# Mirrors the Bash variant with neon vaporwave colors and Unicode accents.

[[ -n ${ZSH_VERSION-} ]] || return 0

setopt prompt_subst               # Enable \$(...) evaluation during prompt rendering

autoload -Uz colors add-zsh-hook
colors                            # Load zsh color definitions

# Prompt formatting helpers (zsh automatically treats these as zero width)
RESET="%f%k%b"
BOLD="%B"

# Vaporwave color palette
NEON_PINK="%F{198}"
NEON_PURPLE="%F{141}"
NEON_CYAN="%F{51}"
NEON_BLUE="%F{39}"
SUNSET_ORANGE="%F{209}"
MINT_GREEN="%F{85}"
DARK_PURPLE="%F{93}"
HOT_MAGENTA="%F{201}"

# Background colors
BG_DARK="%K{234}"

# Git branch helper shown as 『branch』 when inside a repository
prompt_vaporwave_git_branch() {
  local branch
  branch=$(git symbolic-ref --short HEAD 2>/dev/null) || \
    branch=$(git rev-parse --short HEAD 2>/dev/null) || return
  printf '『%s』' "$branch"
}

prompt_vaporwave_render() {
  local style=${MYPROMPTS_PROMPT_STYLE:-compact}
  style=${style:l}

  case $style in
    extended)
      PROMPT="${NEON_PINK}◤${NEON_CYAN}%n${NEON_PINK}◢${RESET}"
      PROMPT+=" ${NEON_CYAN}◆${RESET} "
      PROMPT+="${NEON_PINK}◤${NEON_PURPLE}%m${NEON_PINK}◢${RESET} "
      PROMPT+="${MINT_GREEN}➤ ${NEON_BLUE}%~${RESET} "
      PROMPT+="${HOT_MAGENTA}\$(prompt_vaporwave_git_branch)${RESET}"
      PROMPT+=$'\n'
      PROMPT+="${SUNSET_ORANGE}╰─${NEON_BLUE}▸${RESET} "
      ;;
    *)
      PROMPT="${BG_DARK}${NEON_PINK}◤${NEON_CYAN}%n${DARK_PURPLE}@${NEON_PURPLE}%m${NEON_PINK}◢%k%f "
      PROMPT+="${SUNSET_ORANGE}【${MINT_GREEN}%~${SUNSET_ORANGE}】${RESET} "
      PROMPT+="${HOT_MAGENTA}\$(prompt_vaporwave_git_branch)${RESET} "
      PROMPT+="${NEON_BLUE}${BOLD}▸${RESET} "
      ;;
  esac

  RPROMPT=""
}

prompt_vaporwave_precmd() {
  prompt_vaporwave_render
}

# Ensure we only register the hook once even if sourced repeatedly.
add-zsh-hook -d precmd prompt_vaporwave_precmd 2>/dev/null || true
add-zsh-hook precmd prompt_vaporwave_precmd >/dev/null 2>&1 || true
typeset -ga precmd_functions
precmd_functions=(${(@)precmd_functions:#prompt_vaporwave_precmd} prompt_vaporwave_precmd)

prompt_vaporwave_zle_line_init() {
  prompt_vaporwave_render
}

if add-zsh-hook -d zle-line-init prompt_vaporwave_zle_line_init >/dev/null 2>&1; then
  :
fi
if add-zsh-hook zle-line-init prompt_vaporwave_zle_line_init >/dev/null 2>&1; then
  typeset -ga zle_line_init_functions
  zle_line_init_functions=(${(@)zle_line_init_functions:#prompt_vaporwave_zle_line_init} prompt_vaporwave_zle_line_init)
fi

prompt_vaporwave_render

# Uncomment the block below for an alternate multi-line prompt aesthetic
# prompt_vaporwave_render() {
#   PROMPT="${DARK_PURPLE}【${NEON_PINK}%n${DARK_PURPLE}】${RESET}"
#   PROMPT+="${NEON_CYAN}◆${RESET}"
#   PROMPT+="${DARK_PURPLE}【${NEON_PURPLE}%m${DARK_PURPLE}】${RESET} "
#   PROMPT+="${MINT_GREEN}➤ ${NEON_BLUE}%~${RESET} "
#   PROMPT+="${HOT_MAGENTA}\$(prompt_vaporwave_git_branch)${RESET}\n"
#   PROMPT+="${SUNSET_ORANGE}╰─▸${RESET} "
#   RPROMPT=""
# }
